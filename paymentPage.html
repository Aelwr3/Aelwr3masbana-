<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>صفحة الدفع</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');

    body {
      font-family: 'Amiri', serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(to bottom, #002b4d, #004c6d);
      color: white;
      text-align: center;
      overflow-x: hidden;
    }

    h1 {
      font-weight: 700;
      margin: 20px;
    }

    .payment-container {
      width: 80%;
      margin: 20px auto;
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      transform: perspective(800px) rotateX(10deg);
      animation: float 3s ease-in-out infinite;
    }

    .payment-details {
      margin-bottom: 20px;
    }

    #totalAmount {
      font-size: 20px;
      margin-top: 10px;
      font-weight: bold;
      color: #ffdf5d;
    }

    button {
      padding: 8px 12px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #1e7e34;
    }

    .delete-button {
      background-color: #ff5e57;
    }

    .delete-button:hover {
      background-color: #cc4c45;
    }

    @keyframes float {
      0% {
        transform: perspective(800px) rotateX(10deg) translateY(0px);
      }
      50% {
        transform: perspective(800px) rotateX(10deg) translateY(-10px);
      }
      100% {
        transform: perspective(800px) rotateX(10deg) translateY(0px);
      }
    }

    .confirmation-message {
      margin-top: 20px;
      color: #28a745;
      font-weight: bold;
      font-size: 18px;
    }

    .warning-message {
      margin-top: 20px;
      color: #ffdf5d;
      font-weight: bold;
      font-size: 18px;
    }
  </style>
</head>
<body>

  <h1>صفحة الدفع</h1>

  <div class="payment-container">
    <div class="payment-details">
      <p>اسم الزبون: <span id="customerName"></span></p>
      <p>رقم الفاتورة: <span id="invoiceNumber"></span></p>
      <p>تاريخ الفاتورة: <span id="invoiceDate"></span></p>
      <p>حالة الدفع: <span id="paymentStatus">غير مدفوع</span></p>
    </div>

    <div id="totalAmount">مجموع الفاتورة: <span id="totalAmountValue">0</span> درهم</div>

    <div>
      <button id="payFull">دفع كامل</button>
      <button id="payPartial">دفع جزئي</button>
    </div>

    <div class="warning-message" id="warningMessage" style="display: none;">
      ملاحظة: بعد تأكيد الدفع، لن تتمكن من تعديل تفاصيل الفاتورة (مثل الأصناف أو الكميات أو الأسعار). يمكنك تعديل حالة الدفع فقط في حالة الدفع الجزئي إذا تم دفع باقي المبلغ في المستقبل.
    </div>

    <button id="confirmButton" style="display: none;">تأكيد</button>

    <div class="confirmation-message" id="confirmationMessage" style="display: none;">تم تحديث حالة الدفع بنجاح!</div>
  </div>

  <script>
    // جلب البيانات من localStorage
    let customerName = localStorage.getItem('selectedCustomer') || 'غير محدد';
    let invoiceNumber = localStorage.getItem('invoiceNumber') || '1';
    let totalAmount = parseFloat(localStorage.getItem('totalAmount') || '0');
    
    // عرض التفاصيل على الصفحة
    document.getElementById('customerName').textContent = customerName;
    document.getElementById('invoiceNumber').textContent = invoiceNumber;
    document.getElementById('invoiceDate').textContent = new Date().toLocaleDateString();
    document.getElementById('totalAmountValue').textContent = totalAmount.toFixed(2);

    // تحديد زر الدفع
    document.getElementById('payFull').addEventListener('click', () => {
      document.getElementById('paymentStatus').textContent = 'مدفوع بالكامل';
      document.getElementById('warningMessage').style.display = 'block';
      document.getElementById('confirmButton').style.display = 'inline-block';
    });

    document.getElementById('payPartial').addEventListener('click', () => {
      document.getElementById('paymentStatus').textContent = 'دفع جزئي';
      document.getElementById('warningMessage').style.display = 'block';
      document.getElementById('confirmButton').style.display = 'inline-block';
    });

    // عند الضغط على زر التأكيد
    document.getElementById('confirmButton').addEventListener('click', () => {
      let paymentStatus = document.getElementById('paymentStatus').textContent;
      
      // حفظ حالة الدفع في localStorage
      let invoices = JSON.parse(localStorage.getItem('invoices')) || [];
      let currentInvoice = {
        invoiceNumber: invoiceNumber,
        customerName: customerName,
        date: new Date().toLocaleDateString(),
        totalAmount: totalAmount.toFixed(2),
        paymentStatus: paymentStatus
      };
      invoices.push(currentInvoice);
      localStorage.setItem('invoices', JSON.stringify(invoices));

      // عرض رسالة تأكيد
      document.getElementById('confirmationMessage').style.display = 'block';

      // الانتقال إلى الصفحة التالية بعد 1.5 ثانية
      setTimeout(() => {
        window.location.href = 'nextPage.html'; // انتقل إلى الصفحة التالية
      }, 1500);
    });
  </script>

</body>
</html>
